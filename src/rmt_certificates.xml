<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook"
         xmlns:its="http://www.w3.org/2005/11/its"
         xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         version="5.2"
         xml:id="cha-manage-certificates">
   <info>
      <title>Managing TLS/SSL certificates</title>
   </info>
   <sect1 xml:id="cha-manage-certificates-https">
      <title>Regenerating HTTPS certificates</title>
      <para>HTTPS certificates should be regenerated before they expire or to include additional common alternative names. No additional actions are required on the client machines registered to the RMT server if only HTTPS certificates are regenerated.</para>
      <procedure>
         <step>
            <para>Stop nginx and rmt-server services.</para>
            <screen><prompt role="root">#</prompt><command>systemctl stop nginx</command><prompt role="root">#</prompt><command>systemctl stop rmt-server</command></screen>
         </step>
         <step>
            <para>Remove previously generated certificates.</para>
            <screen><prompt role="root">#</prompt><command>rm /etc/rmt/ssl/rmt-server.*</command></screen>
         </step>
         <step>
            <para>Run the <command>yast rmt</command> module as described in <xref linkend="sec-rmt-installation-yast-configuration"/>.</para>
         </step>
      </procedure>
   </sect1>
   <sect1 xml:id="cha-manage-certificates-ca">
      <title>Regenerating CA certificates and HTTPS certificates</title>
      <para>CA certificates can be regenerated after they have expired or in case of security issues.</para>
      <warning>
         <title>Import CA certificate on all clients</title>
         <para>The newly generated CA certificate must be imported on all clients registered to the RMT server. This can be done by running the <command>rmt-client-setup</command> script on the client machines as described in <xref linkend="sec-rmt-client-clientsetupscript"/>.</para>
      </warning>
      <procedure>
         <step>
            <para>Stop nginx and rmt-server services.</para>
            <screen><prompt role="root">#</prompt><command>systemctl stop nginx</command><prompt role="root">#</prompt><command>systemctl stop rmt-server</command></screen>
         </step>
         <step>
            <para>Remove previously generated CA and HTTPS certificates.</para>
            <screen><prompt role="root">#</prompt><command>rm /etc/rmt/ssl/rmt-ca.*</command><prompt role="root">#</prompt><command>rm /etc/rmt/ssl/rmt-server.*</command></screen>
         </step>
         <step>
            <para>Run the <command>yast rmt</command> module as described in <xref linkend="sec-rmt-installation-yast-configuration"/>.</para>
         </step>
      </procedure>
   </sect1>
</chapter>
