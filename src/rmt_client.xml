<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook"
         xmlns:its="http://www.w3.org/2005/11/its"
         xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         version="5.2"
         xml:id="cha-rmt-client"><!-- ================================================================== -->
   <title>Configuring clients to use RMT</title>
   <info/>
   <para>Any machine running SUSE Linux Enterprise 12 or newer can be configured to register against RMT and download software updates from there, instead of communicating directly with SUSE Customer Center.</para>
   <tip>
      <title>Register with the RMT server over HTTP</title>
      <para>We recommend registering with the RMT server over a secured HTTPS protocol (all examples in this documentation use it). However, you can also register with the RMT server over an insecure HTTP protocol. Use this approach only if your setup benefits from it <emphasis role="bold">and</emphasis> only in a trusted environment where security is not crucial.</para>
   </tip>
   <para>To configure clients to use the RMT server, use one of the following methods:</para>
   <itemizedlist>
      <listitem>
         <para>Provide the required information with boot parameters. See <xref linkend="sec-rmt-client-parameters"/>.</para>
      </listitem>
      <listitem>
         <para>Configure the clients using an AutoYaST profile. See <xref linkend="sec-rmt-client-autoyast"/>.</para>
      </listitem>
      <listitem>
         <para>Use the <command>rmt-client-setup</command> command. See <xref linkend="sec-rmt-client-clientsetupscript"/>.</para>
      </listitem>
      <listitem>
         <para>Use the YaST registration module during installation or later. See <xref linkend="sec-rmt-client-yast"/>.</para>
      </listitem>
   </itemizedlist>
   <tip>
      <title>CA certificate</title>
      <para>If you need the CA certificate of the RMT server, find it at <filename>/etc/rmt/ssl/rmt-ca.crt</filename> and <literal>https://<replaceable>RMT_SERVER</replaceable>/rmt.crt</literal>.</para>
   </tip>
   <!-- ============================================================== -->
   <sect1 xml:id="sec-rmt-client-parameters">
      <title>Configuring clients with boot parameters</title>
      <para>Any client can be configured to use RMT by providing the <option>regurl</option> parameter during machine boot.</para>
      <para>The parameter needs to be entered as <option>regurl=<replaceable>RMT_SERVER_URL</replaceable></option>. The URL needs to be in the following format: <literal>https://<replaceable>FQDN</replaceable></literal>, with <replaceable>FQDN</replaceable> being the fully qualified host name of the RMT server. It must be identical to the FQDN of the server certificate used on the RMT server. Example:</para>
      <screen>regurl=https://rmt.example.com</screen>
      <warning>
         <title>Beware of typing errors</title>
         <para>Make sure the values you enter are correct. If <option>regurl</option> has not been specified correctly, the registration of the update source fails.</para>
      </warning>
      <note>
         <title>Change of RMT server certificate</title>
         <para>If the RMT server gets a new certificate from an untrusted CA, the clients need to retrieve the new CA certificate file. YaST displays a dialog for importing a new certificate. If you confirm importing the new certificate, the old one is replaced with the new one.</para>
      </note>
   </sect1>
   <sect1 xml:id="sec-rmt-client-autoyast">
      <title>Configuring clients with AutoYaST profile</title>
      <para>Clients can be configured to register with the RMT server via an AutoYaST profile. To learn about creating AutoYaST profiles and preparing for automatic installation, refer to the <emphasis>AutoYaST Guide</emphasis>. In this section, only RMT specific configuration is described.</para>
      <para>To configure RMT specific data using AutoYaST, follow the steps for the relevant version of the RMT client.</para>
      <procedure>
         <step>
            <para>As <systemitem class="username">root</systemitem>, start YaST and select <menuchoice><guimenu>Miscellaneous</guimenu><guimenu>Autoinstallation</guimenu></menuchoice> to start the graphical AutoYaST front-end.</para>
            <para>From a command line, you can start the graphical AutoYaST front-end with the <command>yast2 autoyast</command> command.</para>
         </step>
         <step>
            <para>Open an existing profile using <menuchoice><guimenu>File</guimenu><guimenu>Open</guimenu></menuchoice>. Create a profile based on the current system's configuration using <menuchoice><guimenu>Tools</guimenu><guimenu>Create Reference Profile</guimenu></menuchoice>, or work with an empty profile.</para>
         </step>
         <step>
            <para>Select <menuchoice><guimenu>Software</guimenu><guimenu>Product Registration</guimenu></menuchoice>. An overview of the current configuration is shown.</para>
         </step>
         <step>
            <para>Click <guimenu>Edit</guimenu>.</para>
         </step>
         <step>
            <para>Check <guimenu>Register the Product</guimenu>, set the URL of the RMT server in <guimenu>Use Specific Server URL Instead of the Default</guimenu>, and you can set the <guimenu>Optional SSL Server Certificate URL</guimenu>. The possible values for the server URL are the same as for the kernel parameter <option>regurl</option>. For the SSL certificate location, you can use either HTTP or HTTPS based URLs.</para>
         </step>
         <step>
            <para>Perform all other configurations needed for the systems to be deployed, then click <guimenu>Finish</guimenu> to return to the main screen.</para>
         </step>
         <step>
            <para>Select <menuchoice><guimenu>File</guimenu><guimenu>Save As</guimenu></menuchoice> and enter a file name for the profile, such as <filename>autoinst.xml</filename>.</para>
         </step>
      </procedure>
   </sect1>
   <!-- ================================================================ -->
   <sect1 xml:id="sec-rmt-client-clientsetupscript">
      <title>Configuring clients with <command>rmt-client-setup</command>
      </title>
      <para>The <command>/usr/share/rmt/public/tools/rmt-client-setup</command> script is provided in the package <package>rmt-server</package>. This script allows you to configure a client machine to use an RMT server. It can also be used to reconfigure an existing client to use a different RMT server.</para>
      <para>To configure a client machine to use RMT with <command>rmt-client-setup</command>, follow these steps:</para>
      <procedure>
         <step>
            <para>Download <filename>rmt-client-setup</filename> from the RMT server:</para>
            <screen><prompt role="root">#</prompt><command>curl http://<replaceable>RMT_SERVER</replaceable>/tools/rmt-client-setup --output rmt-client-setup</command></screen>
         </step>
         <step>
            <para>Run the script with the URL of the RMT server as a parameter.</para>
            <screen><prompt role="root">#</prompt><command>sh rmt-client-setup https://<replaceable>RMT_SERVER</replaceable>/</command></screen>
            <para>Executing this script imports the RMT CA's certificate into the trusted store.</para>
            <para>Alternatively, you can specify the correct fingerprint or path to the server certificate. For details, see <command>sh rmt-client-setup --help</command>.</para>
         </step>
         <step>
            <para>The script downloads the server's CA certificate. Accept it by pressing <keycap>Y</keycap>. The tool now performs all necessary modifications to the client.</para>
         </step>
         <step>
            <para>Use <command>SUSEConnect</command> to add more products. For details, run <command>SUSEConnect --help</command> .</para>
         </step>
      </procedure>
   </sect1>
   <!-- ================================================================ -->
   <sect1 xml:id="sec-rmt-client-yast">
      <title>Configuring clients with YaST</title>
      <para>To configure a client to perform the registration against an RMT server, use the YaST <guimenu>Product Registration</guimenu> module <command>yast2 registration</command>.</para>
      <para>On the client, the credentials are not necessary, and you may leave the relevant fields empty. Click <guimenu>Local Registration Server</guimenu> and enter its URL. Then click <guimenu>Next</guimenu> until the exit from the module.</para>
   </sect1>
   <sect1 xml:id="rmt-client-custom-repo">
      <title>Configuring clients for custom stand-alone repositories</title>
      <para>If you created a custom stand-alone repository on the RMT server, it is not registered on client machines with <command>SUSEConnect</command> because it has no parent product.</para>
      <para>To add the repository manually, follow these steps:</para>
      <procedure>
         <step>
            <para>Point your Web browser to the following RMT server URL:</para>
            <screen>https://<replaceable>RMT_SERVER_HOSTNAME/repo/</replaceable></screen>
         </step>
         <step>
            <para>Navigate the browser through the directory structure to your custom repository's <filename>repodata/</filename> subdirectory.</para>
         </step>
         <step>
            <para>On the client machine, add the discovered repository URL:</para>
            <screen><prompt>&gt;</prompt><command>sudo</command> zypper ar <replaceable>CUSTOM_REPO_URL</replaceable><replaceable>CUSTOM_REPO_NAME</replaceable></screen>
         </step>
      </procedure>
   </sect1>
   <sect1 xml:id="sec-rmt-client-list-repositories">
      <title>Listing accessible repositories</title>
      <para>To list available modules and repositories, use <command>SUSEConnect --list-extensions</command>. Alternatively, you can also browse the directory listing of the RMT server by visiting <literal>https://<replaceable>RMT_SERVER</replaceable>/repo/</literal> and its subdirectories.</para>
   </sect1>
   <sect1 xml:id="sec-rmt-client-online-migration">
      <title>Online migration of SUSE Linux Enterprise clients</title>
      <para>SUSE Linux Enterprise clients registered to RMT can be migrated online to the latest service pack of the same major release the same way as clients registered to SUSE Customer Center. Before starting the migration, make sure that RMT has the required products available and mirrored.</para>
      <para>For detailed information on the online migration, see <phrase xmlns:l="http://docbook.org/ns/docbook/l10n" role="document-xref">Book <quote>Upgrade Guide</quote>, </phrase><xref linkend="cha-upgrade-paths" xrefstyle="%label &#34;%c&#34;"/>.</para>
   </sect1>
</chapter>
