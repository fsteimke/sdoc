<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook"
         xmlns:its="http://www.w3.org/2005/11/its"
         xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         version="5.2"
         xml:id="cha-tuning-sapconf">
   <info>
      <title>Tuning SUSE Linux Enterprise for SAP</title>
   </info>
   <para>This chapter presents information about preparing and tuning <phrase role="productname">SUSE Linux Enterprise Server</phrase> to work optimally with SAP applications with <literal>sapconf</literal>. <literal>sapconf</literal> is for SUSE Linux Enterprise systems that install SAP applications. Customers who have SUSE Linux Enterprise Server for SAP applications should use <command>saptune</command>.</para>
   <note>
      <title>The <command>sapconf</command> command has been removed</title>
      <para>In SUSE Linux Enterprise Server and <phrase role="productname">SUSE Linux Enterprise Server</phrase> 11 and 12, the <command>sapconf</command> command was included in the package with the same name.</para>
      <para>For SUSE Linux Enterprise Server and <phrase role="productname">SUSE Linux Enterprise Server</phrase> 15, this has been changed: The command <command>sapconf</command> has been removed from the <package>sapconf</package> package. The package contains a <systemitem class="daemon">systemd</systemitem> service only. There is no <literal>sapconf</literal> command line tool anymore, no <literal>sapconf</literal>/<systemitem class="daemon">tuned</systemitem> profiles, and no <systemitem class="daemon">tuned</systemitem>.</para>
   </note>
   <sect1 xml:id="sec-sapconf-5">
      <title>Tuning SLE Systems with <literal>sapconf</literal> 5</title>
      <para>The package <systemitem>sapconf</systemitem> is available in SUSE Linux Enterprise Server and SUSE Linux Enterprise Server for SAP applications. It sets recommended parameters for the following types of SAP applications: SAP NetWeaver, SAP HANA, and SAP HANA-based applications.</para>
      <variablelist>
         <title>Overview of <literal>sapconf</literal>5 in SUSE® Linux Enterprise Server 12</title>
         <varlistentry>
            <term>
               <literal>sapconf</literal>5 (without <systemitem class="daemon">tuned</systemitem>)</term>
            <listitem>
               <itemizedlist>
                  <listitem>
                     <para>
                        <systemitem>sapconf-netweaver</systemitem> (<literal>sapconf</literal> profile as a replacement for <systemitem class="daemon">tuned</systemitem> profile)</para>
                  </listitem>
                  <listitem>
                     <para>
                        <systemitem>sapconf-hana</systemitem> (<literal>sapconf</literal> profile as a replacement for <systemitem class="daemon">tuned</systemitem> profile)</para>
                  </listitem>
                  <listitem>
                     <para>
                        <systemitem>sapconf-bobj</systemitem> (<literal>sapconf</literal> profile as a replacement for <systemitem class="daemon">tuned</systemitem> profile)</para>
                  </listitem>
                  <listitem>
                     <para>
                        <systemitem>sapconf-ase</systemitem> (<literal>sapconf</literal> profile as a replacement for <systemitem class="daemon">tuned</systemitem> profile)</para>
                  </listitem>
               </itemizedlist>
            </listitem>
         </varlistentry>
      </variablelist>
      <variablelist>
         <title>Overview of <literal>sapconf</literal>5 in SUSE® Linux Enterprise Server 15</title>
         <varlistentry>
            <term>
               <literal>sapconf</literal>5 (without <systemitem class="daemon">tuned</systemitem>)</term>
            <listitem>
               <para>no profiles anymore</para>
            </listitem>
         </varlistentry>
      </variablelist>
      <para>If you previously made changes to the system tuning, those changes may be overwritten by <literal>sapconf</literal>.</para>
      <para>
         <literal>sapconf</literal> 5 ships a <systemitem class="daemon">systemd</systemitem> service which applies the tuning and ensures that related services are running.</para>
      <para>To use <literal>sapconf</literal>, make sure that the package <package>sapconf</package> is installed on your system.</para>
      <note>
         <title>No profiles in SUSE Linux Enterprise Server and <phrase role="productname">SUSE Linux Enterprise Server</phrase> <phrase role="productnumber">15 SP7</phrase>
         </title>
         <para>In SUSE Linux Enterprise Server and <phrase role="productname">SUSE Linux Enterprise Server</phrase> 15, <literal>sapconf</literal> no longer supports profiles.</para>
      </note>
      <sect2 xml:id="sec-sapconf-5-verify">
         <title>Verifying <literal>sapconf</literal> setup</title>
         <para>With <literal>sapconf</literal> 5.0.2 and up, the check tool <command>sapconf_check</command> is available, which verifies the correct setup of <literal>sapconf</literal>. For example:</para>
         <screen><prompt role="root">#</prompt><command>sapconf_check</command>
This is sapconf_check v1.0.
It verifies if sapconf is set up correctly and will give advice to do so.
Please keep in mind:
{{ - This tool does not check, if the tuning itself works correctly.}}
{{ - Follow the hints from top to down to minimize side effects.}}
Checking sapconf
================
[ OK ] sapconf package has version 5.0.2
[ OK ] saptune.service is inactive
[ OK ] saptune.service is disabled
[WARN] tuned.service is enabled/active with profile 'virtual-guest -&gt; Sapconf does not require tuned! Run 'systemctl stop tuned.service', if not needed otherwise.
[FAIL] sapconf.service is inactive -&gt; Run 'systemctl start sapconf.service' to activate the tuning now.
[FAIL] sapconf.service is disabled -&gt; Run 'systemctl enable sapconf.service' to activate sapconf at boot.1 warning(s) have been found.
2 error(s) have been found.
Sapconf will not work properly!</screen>
         <para>If <command>sapconf_check</command> finds problems, it gives hints on how to resolve the issue. The tool does not verify whether the system has been tuned correctly. It only checks that <literal>sapconf</literal> is set up correctly and has been started.</para>
      </sect2>
      <sect2 xml:id="sec-sapconf-5-enable">
         <title>Enabling and disabling <literal>sapconf</literal> and viewing its status</title>
         <para>After the installation of <literal>sapconf</literal>, the <literal>sapconf</literal> service is enabled.</para>
         <para>You can inspect or change the status of <literal>sapconf</literal> as described in the following:</para>
         <itemizedlist>
            <listitem>
               <para>To see the status of the service <systemitem class="daemon">sapconf</systemitem>:</para>
               <screen><prompt role="root">#</prompt><command>systemctl status sapconf</command></screen>
               <para>The service should be displayed as <emphasis>active (exited)</emphasis>.</para>
            </listitem>
            <listitem>
               <para>To start the service <systemitem class="daemon">sapconf</systemitem>:</para>
               <screen><prompt role="root">#</prompt><command>systemctl start sapconf</command></screen>
            </listitem>
            <listitem>
               <para>Should <systemitem class="daemon">sapconf</systemitem> be disabled, enable and start it with:</para>
               <screen><prompt role="root">#</prompt><command>systemctl enable --now sapconf</command></screen>
            </listitem>
            <listitem>
               <para>To stop the service <systemitem class="daemon">sapconf</systemitem>:</para>
               <screen><prompt role="root">#</prompt><command>systemctl stop sapconf</command></screen>
               <para>This command disables most of the optimizations immediately. The only exceptions from this rule are options that require a system reboot to enable/disable.</para>
            </listitem>
            <listitem>
               <para>To disable <systemitem class="daemon">sapconf</systemitem>, use:</para>
               <screen><prompt role="root">#</prompt><command>systemctl disable sapconf</command></screen>
               <para>If you have not specifically enabled any of the services that <literal>sapconf</literal> depends on, this also disables most tuning parameters and all services used by <literal>sapconf</literal>.</para>
            </listitem>
         </itemizedlist>
         <tip>
            <title>Additional services that <literal>sapconf</literal> relies on</title>
            <para>Besides the <literal>sapconf</literal> service, it also relies on the following two services:</para>
            <itemizedlist>
               <listitem>
                  <para>
                     <systemitem class="daemon">sysstat</systemitem> which collects data on system activity.</para>
               </listitem>
               <listitem>
                  <para>
                     <systemitem class="daemon">uuidd</systemitem> which generates time-based UUIDs that are guaranteed to be unique even in settings where many processor cores are involved. This is necessary for SAP applications.</para>
               </listitem>
            </itemizedlist>
         </tip>
      </sect2>
      <sect2 xml:id="sec-sapconf-5-configure">
         <title>Configuring <literal>sapconf</literal>5</title>
         <para>Generally, the default configuration of <literal>sapconf</literal> already uses the parameter values recommended by SAP. However, if you have special needs, you can configure the tool to better suit those.</para>
         <para>All parameters of <literal>sapconf</literal> can be found in the file <filename>/etc/sysconfig/sapconf</filename>. The file can be edited directly. All parameters in this file are explained by comments and references to SAP Notes, which can be viewed at <link xlink:href="https://launchpad.support.sap.com/"/>.</para>
         <para>When <literal>sapconf</literal> is updated, all customized parameters from this file are preserved as much as possible. However, sometimes parameters cannot be transferred cleanly to the new configuration file. Therefore, after updating it is advisable to check the difference between the previous custom configuration, which during the update is moved to <filename>/etc/sysconfig/sapconf.rpmsave</filename>, and the new version at <filename>/etc/sysconfig/sapconf</filename>.</para>
         <para>Log messages related to this file are written to <filename>/var/log/sapconf.log</filename>.</para>
         <para>When editing either of these files, you can find that certain values are commented by a <literal>#</literal> character at the beginning of the line. This means that while the parameter is relevant for tuning, there is no suitable default for it.</para>
         <para>Conversely, you can add <literal>#</literal> characters to the beginning of the line to comment specific parameters. However, you should avoid this practice, as it can lead to <literal>sapconf</literal> not properly applying the profile.</para>
         <para>To apply the edited configuration, restart <literal>sapconf</literal>:</para>
         <screen><prompt role="root">#</prompt><command>systemctl restart sapconf</command></screen>
         <para>Confirming that a certain parameter value was applied correctly works differently for different parameters. Hence, the following serves as an example only:</para>
         <example xml:id="ex-sapconf-change-parameter-5">
            <title>Checking Parameters</title>
            <para>To confirm that the setting for <literal>TCP_SLOW_START</literal> was applied, do the following:</para>
            <itemizedlist>
               <listitem>
                  <para>View the log file of <literal>sapconf</literal> to see whether it applied the value. Within <filename>/var/log/sapconf.log</filename>, check for a line containing this text:</para>
                  <screen>Change net.ipv4.tcp_slow_start_after_idle from 1 to 0</screen>
                  <para>Alternatively, the parameter may have already been set correctly before <literal>sapconf</literal> was started. In this case, <literal>sapconf</literal> does not change its value:</para>
                  <screen>Leaving net.ipv4.tcp_slow_start_after_idle unchanged at 1</screen>
               </listitem>
               <listitem>
                  <para>The underlying option behind <literal>TCP_SLOW_START</literal> can be manually configured at <filename>/proc/sys/net.ipv4.tcp_slow_start_after_idle</filename>. To check its actual current value, use:</para>
                  <screen><prompt role="root">#</prompt><command>sysctl net.ipv4.tcp_slow_start_after_idle</command></screen>
               </listitem>
            </itemizedlist>
         </example>
      </sect2>
      <sect2 xml:id="sec-sapconf-5-remove">
         <title>Removing <literal>sapconf</literal>
         </title>
         <para>To remove <literal>sapconf</literal> from a system, uninstall its package with:</para>
         <screen><prompt role="root">#</prompt><command>zypper rm sapconf</command></screen>
         <para>When doing this, dependencies of <literal>sapconf</literal> remain installed. However, the service <systemitem class="daemon">sysstat</systemitem> goes into a disabled state. If it is still relevant to you, make sure to enable it again.</para>
      </sect2>
      <sect2 xml:id="sec-sapconf-5-more">
         <title>For more information</title>
         <para>The following man pages provide additional information about <literal>sapconf</literal>:</para>
         <itemizedlist>
            <listitem>
               <para>Detailed description of all tuning parameters set by <literal>sapconf</literal>: <command>man 5 sapconf</command>
               </para>
            </listitem>
            <listitem>
               <para>Information about configuring and customizing the <literal>sapconf</literal> profile: <command>man 7 sapconf</command>
               </para>
            </listitem>
         </itemizedlist>
         <para>Also see the blog series detailing the updated version of <literal>sapconf</literal> at <link xlink:href="https://www.suse.com/c/a-new-sapconf-is-available/"/>.</para>
      </sect2>
      <sect2 xml:id="sec-sapconf-5-tuned">
         <title>Using <command>tuned</command> together with <literal>sapconf</literal>
         </title>
         <para>With version 5, <literal>sapconf</literal> does not rely on <systemitem class="daemon">tuned</systemitem> anymore. This means both tools can be used independently. <literal>sapconf</literal> prints a warning in its log if the <command>tuned</command> service is started.</para>
         <important>
            <title>Using <command>tuned</command> and <literal>sapconf</literal> together</title>
            <para>If you are going to use <command>tuned</command> and <literal>sapconf</literal> simultaneously, ensure that both tools do not configure the same system parameters.</para>
         </important>
      </sect2>
   </sect1>
</chapter>
